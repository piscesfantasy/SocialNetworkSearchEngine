<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>ver_20120624/Plurk/oauth2/httplib2/iri2uri.py Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>ver_20120624/Plurk/oauth2/httplib2/iri2uri.py</h1>  </div>
</div>
<div class="contents">
<div class="fragment"><pre class="fragment"><a name="l00001"></a><a class="code" href="namespacePlurk_1_1oauth2_1_1httplib2_1_1iri2uri.html">00001</a> <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00002"></a>00002 <span class="stringliteral">iri2uri</span>
<a name="l00003"></a>00003 <span class="stringliteral"></span>
<a name="l00004"></a>00004 <span class="stringliteral">Converts an IRI to a URI.</span>
<a name="l00005"></a>00005 <span class="stringliteral"></span>
<a name="l00006"></a>00006 <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00007"></a>00007 __author__ = <span class="stringliteral">&quot;Joe Gregorio (joe@bitworking.org)&quot;</span>
<a name="l00008"></a>00008 __copyright__ = <span class="stringliteral">&quot;Copyright 2006, Joe Gregorio&quot;</span>
<a name="l00009"></a>00009 __contributors__ = []
<a name="l00010"></a>00010 __version__ = <span class="stringliteral">&quot;1.0.0&quot;</span>
<a name="l00011"></a>00011 __license__ = <span class="stringliteral">&quot;MIT&quot;</span>
<a name="l00012"></a>00012 __history__ = <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00013"></a>00013 <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00014"></a>00014 
<a name="l00015"></a>00015 <span class="keyword">import</span> urlparse
<a name="l00016"></a>00016 
<a name="l00017"></a>00017 
<a name="l00018"></a>00018 <span class="comment"># Convert an IRI to a URI following the rules in RFC 3987</span>
<a name="l00019"></a>00019 <span class="comment"># </span>
<a name="l00020"></a>00020 <span class="comment"># The characters we need to enocde and escape are defined in the spec:</span>
<a name="l00021"></a>00021 <span class="comment">#</span>
<a name="l00022"></a>00022 <span class="comment"># iprivate =  %xE000-F8FF / %xF0000-FFFFD / %x100000-10FFFD</span>
<a name="l00023"></a>00023 <span class="comment"># ucschar = %xA0-D7FF / %xF900-FDCF / %xFDF0-FFEF</span>
<a name="l00024"></a>00024 <span class="comment">#         / %x10000-1FFFD / %x20000-2FFFD / %x30000-3FFFD</span>
<a name="l00025"></a>00025 <span class="comment">#         / %x40000-4FFFD / %x50000-5FFFD / %x60000-6FFFD</span>
<a name="l00026"></a>00026 <span class="comment">#         / %x70000-7FFFD / %x80000-8FFFD / %x90000-9FFFD</span>
<a name="l00027"></a>00027 <span class="comment">#         / %xA0000-AFFFD / %xB0000-BFFFD / %xC0000-CFFFD</span>
<a name="l00028"></a>00028 <span class="comment">#         / %xD0000-DFFFD / %xE1000-EFFFD</span>
<a name="l00029"></a>00029 
<a name="l00030"></a>00030 escape_range = [
<a name="l00031"></a>00031    (0xA0, 0xD7FF ),
<a name="l00032"></a>00032    (0xE000, 0xF8FF ),
<a name="l00033"></a>00033    (0xF900, 0xFDCF ),
<a name="l00034"></a>00034    (0xFDF0, 0xFFEF),
<a name="l00035"></a>00035    (0x10000, 0x1FFFD ),
<a name="l00036"></a>00036    (0x20000, 0x2FFFD ),
<a name="l00037"></a>00037    (0x30000, 0x3FFFD),
<a name="l00038"></a>00038    (0x40000, 0x4FFFD ),
<a name="l00039"></a>00039    (0x50000, 0x5FFFD ),
<a name="l00040"></a>00040    (0x60000, 0x6FFFD),
<a name="l00041"></a>00041    (0x70000, 0x7FFFD ),
<a name="l00042"></a>00042    (0x80000, 0x8FFFD ),
<a name="l00043"></a>00043    (0x90000, 0x9FFFD),
<a name="l00044"></a>00044    (0xA0000, 0xAFFFD ),
<a name="l00045"></a>00045    (0xB0000, 0xBFFFD ),
<a name="l00046"></a>00046    (0xC0000, 0xCFFFD),
<a name="l00047"></a>00047    (0xD0000, 0xDFFFD ),
<a name="l00048"></a>00048    (0xE1000, 0xEFFFD),
<a name="l00049"></a>00049    (0xF0000, 0xFFFFD ),
<a name="l00050"></a>00050    (0x100000, 0x10FFFD)
<a name="l00051"></a>00051 ]
<a name="l00052"></a>00052  
<a name="l00053"></a>00053 <span class="keyword">def </span>encode(c):
<a name="l00054"></a>00054     retval = c
<a name="l00055"></a>00055     i = ord(c)
<a name="l00056"></a>00056     <span class="keywordflow">for</span> low, high <span class="keywordflow">in</span> escape_range:
<a name="l00057"></a>00057         <span class="keywordflow">if</span> i &lt; low:
<a name="l00058"></a>00058             <span class="keywordflow">break</span>
<a name="l00059"></a>00059         <span class="keywordflow">if</span> i &gt;= low <span class="keywordflow">and</span> i &lt;= high:
<a name="l00060"></a>00060             retval = <span class="stringliteral">&quot;&quot;</span>.join([<span class="stringliteral">&quot;%%%2X&quot;</span> % ord(o) <span class="keywordflow">for</span> o <span class="keywordflow">in</span> c.encode(<span class="stringliteral">&#39;utf-8&#39;</span>)])
<a name="l00061"></a>00061             <span class="keywordflow">break</span>
<a name="l00062"></a>00062     <span class="keywordflow">return</span> retval
<a name="l00063"></a>00063 
<a name="l00064"></a>00064 
<a name="l00065"></a><a class="code" href="namespacePlurk_1_1oauth2_1_1httplib2_1_1iri2uri.html#a5608825636d4042b0cf4a846f4160f97">00065</a> <span class="keyword">def </span><a class="code" href="namespacePlurk_1_1oauth2_1_1httplib2_1_1iri2uri.html#a5608825636d4042b0cf4a846f4160f97">iri2uri</a>(uri):
<a name="l00066"></a>00066     <span class="stringliteral">&quot;&quot;&quot;Convert an IRI to a URI. Note that IRIs must be </span>
<a name="l00067"></a>00067 <span class="stringliteral">    passed in a unicode strings. That is, do not utf-8 encode</span>
<a name="l00068"></a>00068 <span class="stringliteral">    the IRI before passing it into the function.&quot;&quot;&quot;</span> 
<a name="l00069"></a>00069     <span class="keywordflow">if</span> isinstance(uri ,unicode):
<a name="l00070"></a>00070         (scheme, authority, path, query, fragment) = urlparse.urlsplit(uri)
<a name="l00071"></a>00071         authority = authority.encode(<span class="stringliteral">&#39;idna&#39;</span>)
<a name="l00072"></a>00072         <span class="comment"># For each character in &#39;ucschar&#39; or &#39;iprivate&#39;</span>
<a name="l00073"></a>00073         <span class="comment">#  1. encode as utf-8</span>
<a name="l00074"></a>00074         <span class="comment">#  2. then %-encode each octet of that utf-8 </span>
<a name="l00075"></a>00075         uri = urlparse.urlunsplit((scheme, authority, path, query, fragment))
<a name="l00076"></a>00076         uri = <span class="stringliteral">&quot;&quot;</span>.join([encode(c) <span class="keywordflow">for</span> c <span class="keywordflow">in</span> uri])
<a name="l00077"></a>00077     <span class="keywordflow">return</span> uri
<a name="l00078"></a>00078         
<a name="l00079"></a>00079 <span class="keywordflow">if</span> __name__ == <span class="stringliteral">&quot;__main__&quot;</span>:
<a name="l00080"></a>00080     <span class="keyword">import</span> unittest
<a name="l00081"></a>00081 
<a name="l00082"></a><a class="code" href="classPlurk_1_1oauth2_1_1httplib2_1_1iri2uri_1_1Test.html">00082</a>     <span class="keyword">class </span><a class="code" href="classPlurk_1_1oauth2_1_1httplib2_1_1iri2uri_1_1Test.html">Test</a>(unittest.TestCase):
<a name="l00083"></a>00083 
<a name="l00084"></a><a class="code" href="classPlurk_1_1oauth2_1_1httplib2_1_1iri2uri_1_1Test.html#a12d459ee2bf304c0b50dafc104c963ef">00084</a>         <span class="keyword">def </span>test_uris(self):
<a name="l00085"></a>00085             <span class="stringliteral">&quot;&quot;&quot;Test that URIs are invariant under the transformation.&quot;&quot;&quot;</span>
<a name="l00086"></a>00086             invariant = [ 
<a name="l00087"></a>00087                 <span class="stringliteral">u&quot;ftp://ftp.is.co.za/rfc/rfc1808.txt&quot;</span>,
<a name="l00088"></a>00088                 <span class="stringliteral">u&quot;http://www.ietf.org/rfc/rfc2396.txt&quot;</span>,
<a name="l00089"></a>00089                 <span class="stringliteral">u&quot;ldap://[2001:db8::7]/c=GB?objectClass?one&quot;</span>,
<a name="l00090"></a>00090                 <span class="stringliteral">u&quot;mailto:John.Doe@example.com&quot;</span>,
<a name="l00091"></a>00091                 <span class="stringliteral">u&quot;news:comp.infosystems.www.servers.unix&quot;</span>,
<a name="l00092"></a>00092                 <span class="stringliteral">u&quot;tel:+1-816-555-1212&quot;</span>,
<a name="l00093"></a>00093                 <span class="stringliteral">u&quot;telnet://192.0.2.16:80/&quot;</span>,
<a name="l00094"></a>00094                 <span class="stringliteral">u&quot;urn:oasis:names:specification:docbook:dtd:xml:4.1.2&quot;</span> ]
<a name="l00095"></a>00095             <span class="keywordflow">for</span> uri <span class="keywordflow">in</span> invariant:
<a name="l00096"></a>00096                 self.assertEqual(uri, iri2uri(uri))
<a name="l00097"></a>00097             
<a name="l00098"></a><a class="code" href="classPlurk_1_1oauth2_1_1httplib2_1_1iri2uri_1_1Test.html#aad64dfd9390672779b777f6c24276802">00098</a>         <span class="keyword">def </span>test_iri(self):
<a name="l00099"></a>00099             <span class="stringliteral">&quot;&quot;&quot; Test that the right type of escaping is done for each part of the URI.&quot;&quot;&quot;</span>
<a name="l00100"></a>00100             self.assertEqual(<span class="stringliteral">&quot;http://xn--o3h.com/%E2%98%84&quot;</span>, iri2uri(<span class="stringliteral">u&quot;http://\N{COMET}.com/\N{COMET}&quot;</span>))
<a name="l00101"></a>00101             self.assertEqual(<span class="stringliteral">&quot;http://bitworking.org/?fred=%E2%98%84&quot;</span>, iri2uri(<span class="stringliteral">u&quot;http://bitworking.org/?fred=\N{COMET}&quot;</span>))
<a name="l00102"></a>00102             self.assertEqual(<span class="stringliteral">&quot;http://bitworking.org/#%E2%98%84&quot;</span>, iri2uri(<span class="stringliteral">u&quot;http://bitworking.org/#\N{COMET}&quot;</span>))
<a name="l00103"></a>00103             self.assertEqual(<span class="stringliteral">&quot;#%E2%98%84&quot;</span>, iri2uri(<span class="stringliteral">u&quot;#\N{COMET}&quot;</span>))
<a name="l00104"></a>00104             self.assertEqual(<span class="stringliteral">&quot;/fred?bar=%E2%98%9A#%E2%98%84&quot;</span>, iri2uri(<span class="stringliteral">u&quot;/fred?bar=\N{BLACK LEFT POINTING INDEX}#\N{COMET}&quot;</span>))
<a name="l00105"></a>00105             self.assertEqual(<span class="stringliteral">&quot;/fred?bar=%E2%98%9A#%E2%98%84&quot;</span>, iri2uri(iri2uri(<span class="stringliteral">u&quot;/fred?bar=\N{BLACK LEFT POINTING INDEX}#\N{COMET}&quot;</span>)))
<a name="l00106"></a>00106             self.assertNotEqual(<span class="stringliteral">&quot;/fred?bar=%E2%98%9A#%E2%98%84&quot;</span>, iri2uri(<span class="stringliteral">u&quot;/fred?bar=\N{BLACK LEFT POINTING INDEX}#\N{COMET}&quot;</span>.encode(<span class="stringliteral">&#39;utf-8&#39;</span>)))
<a name="l00107"></a>00107 
<a name="l00108"></a>00108     unittest.main()
<a name="l00109"></a>00109 
<a name="l00110"></a>00110     
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Sun Jun 24 2012 20:50:11 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
