<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>ver_20120624/Twitter/tweepy/oauth.py Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>ver_20120624/Twitter/tweepy/oauth.py</h1>  </div>
</div>
<div class="contents">
<div class="fragment"><pre class="fragment"><a name="l00001"></a><a class="code" href="namespacetweepy_1_1oauth.html">00001</a> <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00002"></a>00002 <span class="stringliteral">The MIT License</span>
<a name="l00003"></a>00003 <span class="stringliteral"></span>
<a name="l00004"></a>00004 <span class="stringliteral">Copyright (c) 2007 Leah Culver</span>
<a name="l00005"></a>00005 <span class="stringliteral"></span>
<a name="l00006"></a>00006 <span class="stringliteral">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<a name="l00007"></a>00007 <span class="stringliteral">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<a name="l00008"></a>00008 <span class="stringliteral">in the Software without restriction, including without limitation the rights</span>
<a name="l00009"></a>00009 <span class="stringliteral">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<a name="l00010"></a>00010 <span class="stringliteral">copies of the Software, and to permit persons to whom the Software is</span>
<a name="l00011"></a>00011 <span class="stringliteral">furnished to do so, subject to the following conditions:</span>
<a name="l00012"></a>00012 <span class="stringliteral"></span>
<a name="l00013"></a>00013 <span class="stringliteral">The above copyright notice and this permission notice shall be included in</span>
<a name="l00014"></a>00014 <span class="stringliteral">all copies or substantial portions of the Software.</span>
<a name="l00015"></a>00015 <span class="stringliteral"></span>
<a name="l00016"></a>00016 <span class="stringliteral">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<a name="l00017"></a>00017 <span class="stringliteral">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<a name="l00018"></a>00018 <span class="stringliteral">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<a name="l00019"></a>00019 <span class="stringliteral">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<a name="l00020"></a>00020 <span class="stringliteral">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<a name="l00021"></a>00021 <span class="stringliteral">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<a name="l00022"></a>00022 <span class="stringliteral">THE SOFTWARE.</span>
<a name="l00023"></a>00023 <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00024"></a>00024 
<a name="l00025"></a>00025 <span class="keyword">import</span> cgi
<a name="l00026"></a>00026 <span class="keyword">import</span> urllib
<a name="l00027"></a>00027 <span class="keyword">import</span> time
<a name="l00028"></a>00028 <span class="keyword">import</span> random
<a name="l00029"></a>00029 <span class="keyword">import</span> urlparse
<a name="l00030"></a>00030 <span class="keyword">import</span> hmac
<a name="l00031"></a>00031 <span class="keyword">import</span> binascii
<a name="l00032"></a>00032 
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 VERSION = <span class="stringliteral">&#39;1.0&#39;</span> <span class="comment"># Hi Blaine!</span>
<a name="l00035"></a>00035 HTTP_METHOD = <span class="stringliteral">&#39;GET&#39;</span>
<a name="l00036"></a>00036 SIGNATURE_METHOD = <span class="stringliteral">&#39;PLAINTEXT&#39;</span>
<a name="l00037"></a>00037 
<a name="l00038"></a>00038 
<a name="l00039"></a><a class="code" href="classtweepy_1_1oauth_1_1OAuthError.html">00039</a> <span class="keyword">class </span><a class="code" href="classtweepy_1_1oauth_1_1OAuthError.html">OAuthError</a>(RuntimeError):
<a name="l00040"></a>00040     <span class="stringliteral">&quot;&quot;&quot;Generic exception class.&quot;&quot;&quot;</span>
<a name="l00041"></a>00041     <span class="keyword">def </span>__init__(self, message=&#39;OAuth error occured.&#39;):
<a name="l00042"></a>00042         self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthError.html#af2a49463b4152948a7dd710d3abc4e90">message</a> = message
<a name="l00043"></a>00043 
<a name="l00044"></a><a class="code" href="namespacetweepy_1_1oauth.html#acb52629512ae200e40dbc51fe77c65cb">00044</a> <span class="keyword">def </span><a class="code" href="namespacetweepy_1_1oauth.html#acb52629512ae200e40dbc51fe77c65cb">build_authenticate_header</a>(realm=&#39;&#39;):
<a name="l00045"></a>00045     <span class="stringliteral">&quot;&quot;&quot;Optional WWW-Authenticate header (401 error)&quot;&quot;&quot;</span>
<a name="l00046"></a>00046     <span class="keywordflow">return</span> {<span class="stringliteral">&#39;WWW-Authenticate&#39;</span>: <span class="stringliteral">&#39;OAuth realm=&quot;%s&quot;&#39;</span> % realm}
<a name="l00047"></a>00047 
<a name="l00048"></a><a class="code" href="namespacetweepy_1_1oauth.html#a783dd37dd245e89d3f65a96d0107ccd4">00048</a> <span class="keyword">def </span><a class="code" href="namespacetweepy_1_1oauth.html#a783dd37dd245e89d3f65a96d0107ccd4">escape</a>(s):
<a name="l00049"></a>00049     <span class="stringliteral">&quot;&quot;&quot;Escape a URL including any /.&quot;&quot;&quot;</span>
<a name="l00050"></a>00050     <span class="keywordflow">return</span> urllib.quote(s, safe=<span class="stringliteral">&#39;~&#39;</span>)
<a name="l00051"></a>00051 
<a name="l00052"></a>00052 <span class="keyword">def </span>_utf8_str(s):
<a name="l00053"></a>00053     <span class="stringliteral">&quot;&quot;&quot;Convert unicode to utf-8.&quot;&quot;&quot;</span>
<a name="l00054"></a>00054     <span class="keywordflow">if</span> isinstance(s, unicode):
<a name="l00055"></a>00055         <span class="keywordflow">return</span> s.encode(<span class="stringliteral">&quot;utf-8&quot;</span>)
<a name="l00056"></a>00056     <span class="keywordflow">else</span>:
<a name="l00057"></a>00057         <span class="keywordflow">return</span> str(s)
<a name="l00058"></a>00058 
<a name="l00059"></a><a class="code" href="namespacetweepy_1_1oauth.html#aaf2d1d68af101f461fe78000fd03efd0">00059</a> <span class="keyword">def </span><a class="code" href="namespacetweepy_1_1oauth.html#aaf2d1d68af101f461fe78000fd03efd0">generate_timestamp</a>():
<a name="l00060"></a>00060     <span class="stringliteral">&quot;&quot;&quot;Get seconds since epoch (UTC).&quot;&quot;&quot;</span>
<a name="l00061"></a>00061     <span class="keywordflow">return</span> int(time.time())
<a name="l00062"></a>00062 
<a name="l00063"></a><a class="code" href="namespacetweepy_1_1oauth.html#a3527bf6c734cec48a68b156845b7b77d">00063</a> <span class="keyword">def </span><a class="code" href="namespacetweepy_1_1oauth.html#a3527bf6c734cec48a68b156845b7b77d">generate_nonce</a>(length=8):
<a name="l00064"></a>00064     <span class="stringliteral">&quot;&quot;&quot;Generate pseudorandom number.&quot;&quot;&quot;</span>
<a name="l00065"></a>00065     <span class="keywordflow">return</span> <span class="stringliteral">&#39;&#39;</span>.join([str(random.randint(0, 9)) <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(length)])
<a name="l00066"></a>00066 
<a name="l00067"></a><a class="code" href="namespacetweepy_1_1oauth.html#ae5cf5e69e5bf1c0ec3fc24bdbc79e7d0">00067</a> <span class="keyword">def </span><a class="code" href="namespacetweepy_1_1oauth.html#ae5cf5e69e5bf1c0ec3fc24bdbc79e7d0">generate_verifier</a>(length=8):
<a name="l00068"></a>00068     <span class="stringliteral">&quot;&quot;&quot;Generate pseudorandom number.&quot;&quot;&quot;</span>
<a name="l00069"></a>00069     <span class="keywordflow">return</span> <span class="stringliteral">&#39;&#39;</span>.join([str(random.randint(0, 9)) <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(length)])
<a name="l00070"></a>00070 
<a name="l00071"></a>00071 
<a name="l00072"></a><a class="code" href="classtweepy_1_1oauth_1_1OAuthConsumer.html">00072</a> <span class="keyword">class </span><a class="code" href="classtweepy_1_1oauth_1_1OAuthConsumer.html">OAuthConsumer</a>(object):
<a name="l00073"></a>00073     <span class="stringliteral">&quot;&quot;&quot;Consumer of OAuth authentication.</span>
<a name="l00074"></a>00074 <span class="stringliteral"></span>
<a name="l00075"></a>00075 <span class="stringliteral">    OAuthConsumer is a data type that represents the identity of the Consumer</span>
<a name="l00076"></a>00076 <span class="stringliteral">    via its shared secret with the Service Provider.</span>
<a name="l00077"></a>00077 <span class="stringliteral"></span>
<a name="l00078"></a>00078 <span class="stringliteral">    &quot;&quot;&quot;</span>
<a name="l00079"></a>00079     key = <span class="keywordtype">None</span>
<a name="l00080"></a>00080     secret = <span class="keywordtype">None</span>
<a name="l00081"></a>00081 
<a name="l00082"></a>00082     <span class="keyword">def </span>__init__(self, key, secret):
<a name="l00083"></a>00083         self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthConsumer.html#a9b6861f65c9a29bdc2ae9a194f24f6b0">key</a> = key
<a name="l00084"></a>00084         self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthConsumer.html#a823501f295ca429d19e5026129b5ff14">secret</a> = secret
<a name="l00085"></a>00085 
<a name="l00086"></a>00086 
<a name="l00087"></a><a class="code" href="classtweepy_1_1oauth_1_1OAuthToken.html">00087</a> <span class="keyword">class </span><a class="code" href="classtweepy_1_1oauth_1_1OAuthToken.html">OAuthToken</a>(object):
<a name="l00088"></a>00088     <span class="stringliteral">&quot;&quot;&quot;OAuthToken is a data type that represents an End User via either an access</span>
<a name="l00089"></a>00089 <span class="stringliteral">    or request token.</span>
<a name="l00090"></a>00090 <span class="stringliteral">    </span>
<a name="l00091"></a>00091 <span class="stringliteral">    key -- the token</span>
<a name="l00092"></a>00092 <span class="stringliteral">    secret -- the token secret</span>
<a name="l00093"></a>00093 <span class="stringliteral"></span>
<a name="l00094"></a>00094 <span class="stringliteral">    &quot;&quot;&quot;</span>
<a name="l00095"></a>00095     key = <span class="keywordtype">None</span>
<a name="l00096"></a>00096     secret = <span class="keywordtype">None</span>
<a name="l00097"></a>00097     callback = <span class="keywordtype">None</span>
<a name="l00098"></a>00098     callback_confirmed = <span class="keywordtype">None</span>
<a name="l00099"></a>00099     verifier = <span class="keywordtype">None</span>
<a name="l00100"></a>00100 
<a name="l00101"></a>00101     <span class="keyword">def </span>__init__(self, key, secret):
<a name="l00102"></a>00102         self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthToken.html#a973247e0cd56cb8461f27e132157893a">key</a> = key
<a name="l00103"></a>00103         self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthToken.html#a5f3c3dcd412a3570eaa6735b24379254">secret</a> = secret
<a name="l00104"></a>00104 
<a name="l00105"></a>00105     <span class="keyword">def </span>set_callback(self, callback):
<a name="l00106"></a>00106         self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthToken.html#a1b1349007c6aa53aa2acd648ef1715a6">callback</a> = callback
<a name="l00107"></a>00107         self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthToken.html#a47777c4ae2a4a25a2f20c61e31a5611d">callback_confirmed</a> = <span class="stringliteral">&#39;true&#39;</span>
<a name="l00108"></a>00108 
<a name="l00109"></a>00109     <span class="keyword">def </span>set_verifier(self, verifier=None):
<a name="l00110"></a>00110         <span class="keywordflow">if</span> verifier <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:
<a name="l00111"></a>00111             self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthToken.html#aa9e620250c623c5ceb54056a4ff5d6bc">verifier</a> = verifier
<a name="l00112"></a>00112         <span class="keywordflow">else</span>:
<a name="l00113"></a>00113             self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthToken.html#aa9e620250c623c5ceb54056a4ff5d6bc">verifier</a> = generate_verifier()
<a name="l00114"></a>00114 
<a name="l00115"></a>00115     <span class="keyword">def </span>get_callback_url(self):
<a name="l00116"></a>00116         <span class="keywordflow">if</span> self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthToken.html#a1b1349007c6aa53aa2acd648ef1715a6">callback</a> <span class="keywordflow">and</span> self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthToken.html#aa9e620250c623c5ceb54056a4ff5d6bc">verifier</a>:
<a name="l00117"></a>00117             <span class="comment"># Append the oauth_verifier.</span>
<a name="l00118"></a>00118             parts = urlparse.urlparse(self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthToken.html#a1b1349007c6aa53aa2acd648ef1715a6">callback</a>)
<a name="l00119"></a>00119             scheme, netloc, path, params, query, fragment = parts[:6]
<a name="l00120"></a>00120             <span class="keywordflow">if</span> query:
<a name="l00121"></a>00121                 query = <span class="stringliteral">&#39;%s&amp;oauth_verifier=%s&#39;</span> % (query, self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthToken.html#aa9e620250c623c5ceb54056a4ff5d6bc">verifier</a>)
<a name="l00122"></a>00122             <span class="keywordflow">else</span>:
<a name="l00123"></a>00123                 query = <span class="stringliteral">&#39;oauth_verifier=%s&#39;</span> % self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthToken.html#aa9e620250c623c5ceb54056a4ff5d6bc">verifier</a>
<a name="l00124"></a>00124             <span class="keywordflow">return</span> urlparse.urlunparse((scheme, netloc, path, params,
<a name="l00125"></a>00125                 query, fragment))
<a name="l00126"></a>00126         <span class="keywordflow">return</span> self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthToken.html#a1b1349007c6aa53aa2acd648ef1715a6">callback</a>
<a name="l00127"></a>00127 
<a name="l00128"></a>00128     <span class="keyword">def </span>to_string(self):
<a name="l00129"></a>00129         data = {
<a name="l00130"></a>00130             <span class="stringliteral">&#39;oauth_token&#39;</span>: self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthToken.html#a973247e0cd56cb8461f27e132157893a">key</a>,
<a name="l00131"></a>00131             <span class="stringliteral">&#39;oauth_token_secret&#39;</span>: self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthToken.html#a5f3c3dcd412a3570eaa6735b24379254">secret</a>,
<a name="l00132"></a>00132         }
<a name="l00133"></a>00133         <span class="keywordflow">if</span> self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthToken.html#a47777c4ae2a4a25a2f20c61e31a5611d">callback_confirmed</a> <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:
<a name="l00134"></a>00134             data[<span class="stringliteral">&#39;oauth_callback_confirmed&#39;</span>] = self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthToken.html#a47777c4ae2a4a25a2f20c61e31a5611d">callback_confirmed</a>
<a name="l00135"></a>00135         <span class="keywordflow">return</span> urllib.urlencode(data)
<a name="l00136"></a>00136  
<a name="l00137"></a><a class="code" href="classtweepy_1_1oauth_1_1OAuthToken.html#a570ce16ccd99996c3c561919997630a5">00137</a>     <span class="keyword">def </span>from_string(s):
<a name="l00138"></a>00138         <span class="stringliteral">&quot;&quot;&quot; Returns a token from something like:</span>
<a name="l00139"></a>00139 <span class="stringliteral">        oauth_token_secret=xxx&amp;oauth_token=xxx</span>
<a name="l00140"></a>00140 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l00141"></a>00141         params = cgi.parse_qs(s, keep_blank_values=<span class="keyword">False</span>)
<a name="l00142"></a>00142         key = params[<span class="stringliteral">&#39;oauth_token&#39;</span>][0]
<a name="l00143"></a>00143         secret = params[<span class="stringliteral">&#39;oauth_token_secret&#39;</span>][0]
<a name="l00144"></a>00144         token = OAuthToken(key, secret)
<a name="l00145"></a>00145         <span class="keywordflow">try</span>:
<a name="l00146"></a>00146             token.callback_confirmed = params[<span class="stringliteral">&#39;oauth_callback_confirmed&#39;</span>][0]
<a name="l00147"></a>00147         <span class="keywordflow">except</span> KeyError:
<a name="l00148"></a>00148             <span class="keywordflow">pass</span> <span class="comment"># 1.0, no callback confirmed.</span>
<a name="l00149"></a>00149         <span class="keywordflow">return</span> token
<a name="l00150"></a>00150     from_string = staticmethod(from_string)
<a name="l00151"></a>00151 
<a name="l00152"></a>00152     <span class="keyword">def </span>__str__(self):
<a name="l00153"></a>00153         <span class="keywordflow">return</span> self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthToken.html#a052d85776bfc8c6b8ee43df470d67550">to_string</a>()
<a name="l00154"></a>00154 
<a name="l00155"></a>00155 
<a name="l00156"></a><a class="code" href="classtweepy_1_1oauth_1_1OAuthRequest.html">00156</a> <span class="keyword">class </span><a class="code" href="classtweepy_1_1oauth_1_1OAuthRequest.html">OAuthRequest</a>(object):
<a name="l00157"></a>00157     <span class="stringliteral">&quot;&quot;&quot;OAuthRequest represents the request and can be serialized.</span>
<a name="l00158"></a>00158 <span class="stringliteral"></span>
<a name="l00159"></a>00159 <span class="stringliteral">    OAuth parameters:</span>
<a name="l00160"></a>00160 <span class="stringliteral">        - oauth_consumer_key </span>
<a name="l00161"></a>00161 <span class="stringliteral">        - oauth_token</span>
<a name="l00162"></a>00162 <span class="stringliteral">        - oauth_signature_method</span>
<a name="l00163"></a>00163 <span class="stringliteral">        - oauth_signature </span>
<a name="l00164"></a>00164 <span class="stringliteral">        - oauth_timestamp </span>
<a name="l00165"></a>00165 <span class="stringliteral">        - oauth_nonce</span>
<a name="l00166"></a>00166 <span class="stringliteral">        - oauth_version</span>
<a name="l00167"></a>00167 <span class="stringliteral">        - oauth_verifier</span>
<a name="l00168"></a>00168 <span class="stringliteral">        ... any additional parameters, as defined by the Service Provider.</span>
<a name="l00169"></a>00169 <span class="stringliteral">    &quot;&quot;&quot;</span>
<a name="l00170"></a>00170     parameters = <span class="keywordtype">None</span> <span class="comment"># OAuth parameters.</span>
<a name="l00171"></a>00171     http_method = HTTP_METHOD
<a name="l00172"></a>00172     http_url = <span class="keywordtype">None</span>
<a name="l00173"></a>00173     version = VERSION
<a name="l00174"></a>00174 
<a name="l00175"></a>00175     <span class="keyword">def </span>__init__(self, http_method=HTTP_METHOD, http_url=None, parameters=None):
<a name="l00176"></a>00176         self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthRequest.html#a66c38d3b320641378f1fbbecf8c2ede1">http_method</a> = http_method
<a name="l00177"></a>00177         self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthRequest.html#a04d98a748e478765cdc38396e7a78f67">http_url</a> = http_url
<a name="l00178"></a>00178         self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthRequest.html#aab5d82b2192c9608a7a94ad0e4c3bea1">parameters</a> = parameters <span class="keywordflow">or</span> {}
<a name="l00179"></a>00179 
<a name="l00180"></a>00180     <span class="keyword">def </span>set_parameter(self, parameter, value):
<a name="l00181"></a>00181         self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthRequest.html#aab5d82b2192c9608a7a94ad0e4c3bea1">parameters</a>[parameter] = value
<a name="l00182"></a>00182 
<a name="l00183"></a>00183     <span class="keyword">def </span>get_parameter(self, parameter):
<a name="l00184"></a>00184         <span class="keywordflow">try</span>:
<a name="l00185"></a>00185             <span class="keywordflow">return</span> self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthRequest.html#aab5d82b2192c9608a7a94ad0e4c3bea1">parameters</a>[parameter]
<a name="l00186"></a>00186         <span class="keywordflow">except</span>:
<a name="l00187"></a>00187             <span class="keywordflow">raise</span> OAuthError(<span class="stringliteral">&#39;Parameter not found: %s&#39;</span> % parameter)
<a name="l00188"></a>00188 
<a name="l00189"></a>00189     <span class="keyword">def </span>_get_timestamp_nonce(self):
<a name="l00190"></a>00190         <span class="keywordflow">return</span> self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthRequest.html#ac54541e56e97829261fda2422a507ce6">get_parameter</a>(<span class="stringliteral">&#39;oauth_timestamp&#39;</span>), self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthRequest.html#ac54541e56e97829261fda2422a507ce6">get_parameter</a>(
<a name="l00191"></a>00191             <span class="stringliteral">&#39;oauth_nonce&#39;</span>)
<a name="l00192"></a>00192 
<a name="l00193"></a><a class="code" href="classtweepy_1_1oauth_1_1OAuthRequest.html#a00393f3284b193652bfadbdba01625f1">00193</a>     <span class="keyword">def </span><a class="code" href="classtweepy_1_1oauth_1_1OAuthRequest.html#a00393f3284b193652bfadbdba01625f1">get_nonoauth_parameters</a>(self):
<a name="l00194"></a>00194         <span class="stringliteral">&quot;&quot;&quot;Get any non-OAuth parameters.&quot;&quot;&quot;</span>
<a name="l00195"></a>00195         parameters = {}
<a name="l00196"></a>00196         <span class="keywordflow">for</span> k, v <span class="keywordflow">in</span> self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthRequest.html#aab5d82b2192c9608a7a94ad0e4c3bea1">parameters</a>.iteritems():
<a name="l00197"></a>00197             <span class="comment"># Ignore oauth parameters.</span>
<a name="l00198"></a>00198             <span class="keywordflow">if</span> k.find(<span class="stringliteral">&#39;oauth_&#39;</span>) &lt; 0:
<a name="l00199"></a>00199                 parameters[k] = v
<a name="l00200"></a>00200         <span class="keywordflow">return</span> parameters
<a name="l00201"></a>00201 
<a name="l00202"></a><a class="code" href="classtweepy_1_1oauth_1_1OAuthRequest.html#ae531cc4edbf19293c827925e6d2213ae">00202</a>     <span class="keyword">def </span><a class="code" href="classtweepy_1_1oauth_1_1OAuthRequest.html#ae531cc4edbf19293c827925e6d2213ae">to_header</a>(self, realm=&#39;&#39;):
<a name="l00203"></a>00203         <span class="stringliteral">&quot;&quot;&quot;Serialize as a header for an HTTPAuth request.&quot;&quot;&quot;</span>
<a name="l00204"></a>00204         auth_header = <span class="stringliteral">&#39;OAuth realm=&quot;%s&quot;&#39;</span> % realm
<a name="l00205"></a>00205         <span class="comment"># Add the oauth parameters.</span>
<a name="l00206"></a>00206         <span class="keywordflow">if</span> self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthRequest.html#aab5d82b2192c9608a7a94ad0e4c3bea1">parameters</a>:
<a name="l00207"></a>00207             <span class="keywordflow">for</span> k, v <span class="keywordflow">in</span> self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthRequest.html#aab5d82b2192c9608a7a94ad0e4c3bea1">parameters</a>.iteritems():
<a name="l00208"></a>00208                 <span class="keywordflow">if</span> k[:6] == <span class="stringliteral">&#39;oauth_&#39;</span>:
<a name="l00209"></a>00209                     auth_header += <span class="stringliteral">&#39;, %s=&quot;%s&quot;&#39;</span> % (k, escape(str(v)))
<a name="l00210"></a>00210         <span class="keywordflow">return</span> {<span class="stringliteral">&#39;Authorization&#39;</span>: auth_header}
<a name="l00211"></a>00211 
<a name="l00212"></a><a class="code" href="classtweepy_1_1oauth_1_1OAuthRequest.html#aa8f242e9de48f3d7b5cf3ac1b5ea3fbe">00212</a>     <span class="keyword">def </span><a class="code" href="classtweepy_1_1oauth_1_1OAuthRequest.html#aa8f242e9de48f3d7b5cf3ac1b5ea3fbe">to_postdata</a>(self):
<a name="l00213"></a>00213         <span class="stringliteral">&quot;&quot;&quot;Serialize as post data for a POST request.&quot;&quot;&quot;</span>
<a name="l00214"></a>00214         <span class="keywordflow">return</span> <span class="stringliteral">&#39;&amp;&#39;</span>.join([<span class="stringliteral">&#39;%s=%s&#39;</span> % (escape(str(k)), escape(str(v))) \
<a name="l00215"></a>00215             <span class="keywordflow">for</span> k, v <span class="keywordflow">in</span> self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthRequest.html#aab5d82b2192c9608a7a94ad0e4c3bea1">parameters</a>.iteritems()])
<a name="l00216"></a>00216 
<a name="l00217"></a><a class="code" href="classtweepy_1_1oauth_1_1OAuthRequest.html#a7997e9ec5bbc4b71fd7daaa9a6835df0">00217</a>     <span class="keyword">def </span><a class="code" href="classtweepy_1_1oauth_1_1OAuthRequest.html#a7997e9ec5bbc4b71fd7daaa9a6835df0">to_url</a>(self):
<a name="l00218"></a>00218         <span class="stringliteral">&quot;&quot;&quot;Serialize as a URL for a GET request.&quot;&quot;&quot;</span>
<a name="l00219"></a>00219         <span class="keywordflow">return</span> <span class="stringliteral">&#39;%s?%s&#39;</span> % (self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthRequest.html#a92e22e6d375bff565050ecbdb41aaad6">get_normalized_http_url</a>(), self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthRequest.html#aa8f242e9de48f3d7b5cf3ac1b5ea3fbe">to_postdata</a>())
<a name="l00220"></a>00220 
<a name="l00221"></a><a class="code" href="classtweepy_1_1oauth_1_1OAuthRequest.html#a8946b4951da117c443da7cc71ae07227">00221</a>     <span class="keyword">def </span><a class="code" href="classtweepy_1_1oauth_1_1OAuthRequest.html#a8946b4951da117c443da7cc71ae07227">get_normalized_parameters</a>(self):
<a name="l00222"></a>00222         <span class="stringliteral">&quot;&quot;&quot;Return a string that contains the parameters that must be signed.&quot;&quot;&quot;</span>
<a name="l00223"></a>00223         params = self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthRequest.html#aab5d82b2192c9608a7a94ad0e4c3bea1">parameters</a>
<a name="l00224"></a>00224         <span class="keywordflow">try</span>:
<a name="l00225"></a>00225             <span class="comment"># Exclude the signature if it exists.</span>
<a name="l00226"></a>00226             del params[<span class="stringliteral">&#39;oauth_signature&#39;</span>]
<a name="l00227"></a>00227         <span class="keywordflow">except</span>:
<a name="l00228"></a>00228             <span class="keywordflow">pass</span>
<a name="l00229"></a>00229         <span class="comment"># Escape key values before sorting.</span>
<a name="l00230"></a>00230         key_values = [(escape(_utf8_str(k)), escape(_utf8_str(v))) \
<a name="l00231"></a>00231             <span class="keywordflow">for</span> k,v <span class="keywordflow">in</span> params.items()]
<a name="l00232"></a>00232         <span class="comment"># Sort lexicographically, first after key, then after value.</span>
<a name="l00233"></a>00233         key_values.sort()
<a name="l00234"></a>00234         <span class="comment"># Combine key value pairs into a string.</span>
<a name="l00235"></a>00235         <span class="keywordflow">return</span> <span class="stringliteral">&#39;&amp;&#39;</span>.join([<span class="stringliteral">&#39;%s=%s&#39;</span> % (k, v) <span class="keywordflow">for</span> k, v <span class="keywordflow">in</span> key_values])
<a name="l00236"></a>00236 
<a name="l00237"></a><a class="code" href="classtweepy_1_1oauth_1_1OAuthRequest.html#a872e5ae7519a35e7ba57db9a270e0d3c">00237</a>     <span class="keyword">def </span><a class="code" href="classtweepy_1_1oauth_1_1OAuthRequest.html#a872e5ae7519a35e7ba57db9a270e0d3c">get_normalized_http_method</a>(self):
<a name="l00238"></a>00238         <span class="stringliteral">&quot;&quot;&quot;Uppercases the http method.&quot;&quot;&quot;</span>
<a name="l00239"></a>00239         <span class="keywordflow">return</span> self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthRequest.html#a66c38d3b320641378f1fbbecf8c2ede1">http_method</a>.upper()
<a name="l00240"></a>00240 
<a name="l00241"></a><a class="code" href="classtweepy_1_1oauth_1_1OAuthRequest.html#a92e22e6d375bff565050ecbdb41aaad6">00241</a>     <span class="keyword">def </span><a class="code" href="classtweepy_1_1oauth_1_1OAuthRequest.html#a92e22e6d375bff565050ecbdb41aaad6">get_normalized_http_url</a>(self):
<a name="l00242"></a>00242         <span class="stringliteral">&quot;&quot;&quot;Parses the URL and rebuilds it to be scheme://host/path.&quot;&quot;&quot;</span>
<a name="l00243"></a>00243         parts = urlparse.urlparse(self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthRequest.html#a04d98a748e478765cdc38396e7a78f67">http_url</a>)
<a name="l00244"></a>00244         scheme, netloc, path = parts[:3]
<a name="l00245"></a>00245         <span class="comment"># Exclude default port numbers.</span>
<a name="l00246"></a>00246         <span class="keywordflow">if</span> scheme == <span class="stringliteral">&#39;http&#39;</span> <span class="keywordflow">and</span> netloc[-3:] == <span class="stringliteral">&#39;:80&#39;</span>:
<a name="l00247"></a>00247             netloc = netloc[:-3]
<a name="l00248"></a>00248         <span class="keywordflow">elif</span> scheme == <span class="stringliteral">&#39;https&#39;</span> <span class="keywordflow">and</span> netloc[-4:] == <span class="stringliteral">&#39;:443&#39;</span>:
<a name="l00249"></a>00249             netloc = netloc[:-4]
<a name="l00250"></a>00250         <span class="keywordflow">return</span> <span class="stringliteral">&#39;%s://%s%s&#39;</span> % (scheme, netloc, path)
<a name="l00251"></a>00251 
<a name="l00252"></a><a class="code" href="classtweepy_1_1oauth_1_1OAuthRequest.html#a7fdf4ce92e58ebf832cada270805662b">00252</a>     <span class="keyword">def </span><a class="code" href="classtweepy_1_1oauth_1_1OAuthRequest.html#a7fdf4ce92e58ebf832cada270805662b">sign_request</a>(self, signature_method, consumer, token):
<a name="l00253"></a>00253         <span class="stringliteral">&quot;&quot;&quot;Set the signature parameter to the result of build_signature.&quot;&quot;&quot;</span>
<a name="l00254"></a>00254         <span class="comment"># Set the signature method.</span>
<a name="l00255"></a>00255         self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthRequest.html#a7d92619fbe68b32d2da08266f3ea6798">set_parameter</a>(<span class="stringliteral">&#39;oauth_signature_method&#39;</span>,
<a name="l00256"></a>00256             signature_method.get_name())
<a name="l00257"></a>00257         <span class="comment"># Set the signature.</span>
<a name="l00258"></a>00258         self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthRequest.html#a7d92619fbe68b32d2da08266f3ea6798">set_parameter</a>(<span class="stringliteral">&#39;oauth_signature&#39;</span>,
<a name="l00259"></a>00259             self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthRequest.html#a62e38e8c52bde15676aee88162689610">build_signature</a>(signature_method, consumer, token))
<a name="l00260"></a>00260 
<a name="l00261"></a><a class="code" href="classtweepy_1_1oauth_1_1OAuthRequest.html#a62e38e8c52bde15676aee88162689610">00261</a>     <span class="keyword">def </span><a class="code" href="classtweepy_1_1oauth_1_1OAuthRequest.html#a62e38e8c52bde15676aee88162689610">build_signature</a>(self, signature_method, consumer, token):
<a name="l00262"></a>00262         <span class="stringliteral">&quot;&quot;&quot;Calls the build signature method within the signature method.&quot;&quot;&quot;</span>
<a name="l00263"></a>00263         <span class="keywordflow">return</span> signature_method.build_signature(self, consumer, token)
<a name="l00264"></a>00264 
<a name="l00265"></a><a class="code" href="classtweepy_1_1oauth_1_1OAuthRequest.html#a5618ac4cdc50d99d7b791f74855dc113">00265</a>     <span class="keyword">def </span>from_request(http_method, http_url, headers=None, parameters=None,
<a name="l00266"></a>00266             query_string=<span class="keywordtype">None</span>):
<a name="l00267"></a>00267         <span class="stringliteral">&quot;&quot;&quot;Combines multiple parameter sources.&quot;&quot;&quot;</span>
<a name="l00268"></a>00268         <span class="keywordflow">if</span> parameters <span class="keywordflow">is</span> <span class="keywordtype">None</span>:
<a name="l00269"></a>00269             parameters = {}
<a name="l00270"></a>00270 
<a name="l00271"></a>00271         <span class="comment"># Headers</span>
<a name="l00272"></a>00272         <span class="keywordflow">if</span> headers <span class="keywordflow">and</span> <span class="stringliteral">&#39;Authorization&#39;</span> <span class="keywordflow">in</span> headers:
<a name="l00273"></a>00273             auth_header = headers[<span class="stringliteral">&#39;Authorization&#39;</span>]
<a name="l00274"></a>00274             <span class="comment"># Check that the authorization header is OAuth.</span>
<a name="l00275"></a>00275             <span class="keywordflow">if</span> auth_header[:6] == <span class="stringliteral">&#39;OAuth &#39;</span>:
<a name="l00276"></a>00276                 auth_header = auth_header[6:]
<a name="l00277"></a>00277                 <span class="keywordflow">try</span>:
<a name="l00278"></a>00278                     <span class="comment"># Get the parameters from the header.</span>
<a name="l00279"></a>00279                     header_params = OAuthRequest._split_header(auth_header)
<a name="l00280"></a>00280                     parameters.update(header_params)
<a name="l00281"></a>00281                 <span class="keywordflow">except</span>:
<a name="l00282"></a>00282                     <span class="keywordflow">raise</span> OAuthError(<span class="stringliteral">&#39;Unable to parse OAuth parameters from &#39;</span>
<a name="l00283"></a>00283                         <span class="stringliteral">&#39;Authorization header.&#39;</span>)
<a name="l00284"></a>00284 
<a name="l00285"></a>00285         <span class="comment"># GET or POST query string.</span>
<a name="l00286"></a>00286         <span class="keywordflow">if</span> query_string:
<a name="l00287"></a>00287             query_params = OAuthRequest._split_url_string(query_string)
<a name="l00288"></a>00288             parameters.update(query_params)
<a name="l00289"></a>00289 
<a name="l00290"></a>00290         <span class="comment"># URL parameters.</span>
<a name="l00291"></a>00291         param_str = urlparse.urlparse(http_url)[4] <span class="comment"># query</span>
<a name="l00292"></a>00292         url_params = OAuthRequest._split_url_string(param_str)
<a name="l00293"></a>00293         parameters.update(url_params)
<a name="l00294"></a>00294 
<a name="l00295"></a>00295         <span class="keywordflow">if</span> parameters:
<a name="l00296"></a>00296             <span class="keywordflow">return</span> OAuthRequest(http_method, http_url, parameters)
<a name="l00297"></a>00297 
<a name="l00298"></a>00298         <span class="keywordflow">return</span> <span class="keywordtype">None</span>
<a name="l00299"></a>00299     from_request = staticmethod(from_request)
<a name="l00300"></a>00300 
<a name="l00301"></a>00301     <span class="keyword">def </span>from_consumer_and_token(oauth_consumer, token=None,
<a name="l00302"></a>00302             callback=<span class="keywordtype">None</span>, verifier=<span class="keywordtype">None</span>, http_method=HTTP_METHOD,
<a name="l00303"></a>00303             http_url=<span class="keywordtype">None</span>, parameters=<span class="keywordtype">None</span>):
<a name="l00304"></a>00304         <span class="keywordflow">if</span> <span class="keywordflow">not</span> parameters:
<a name="l00305"></a>00305             parameters = {}
<a name="l00306"></a>00306 
<a name="l00307"></a>00307         defaults = {
<a name="l00308"></a>00308             <span class="stringliteral">&#39;oauth_consumer_key&#39;</span>: oauth_consumer.key,
<a name="l00309"></a>00309             <span class="stringliteral">&#39;oauth_timestamp&#39;</span>: generate_timestamp(),
<a name="l00310"></a>00310             <span class="stringliteral">&#39;oauth_nonce&#39;</span>: generate_nonce(),
<a name="l00311"></a>00311             <span class="stringliteral">&#39;oauth_version&#39;</span>: OAuthRequest.version,
<a name="l00312"></a>00312         }
<a name="l00313"></a>00313 
<a name="l00314"></a>00314         defaults.update(parameters)
<a name="l00315"></a>00315         parameters = defaults
<a name="l00316"></a>00316 
<a name="l00317"></a>00317         <span class="keywordflow">if</span> token:
<a name="l00318"></a>00318             parameters[<span class="stringliteral">&#39;oauth_token&#39;</span>] = token.key
<a name="l00319"></a>00319             <span class="keywordflow">if</span> token.callback:
<a name="l00320"></a>00320                 parameters[<span class="stringliteral">&#39;oauth_callback&#39;</span>] = token.callback
<a name="l00321"></a>00321             <span class="comment"># 1.0a support for verifier.</span>
<a name="l00322"></a>00322             <span class="keywordflow">if</span> verifier:
<a name="l00323"></a>00323                 parameters[<span class="stringliteral">&#39;oauth_verifier&#39;</span>] = verifier
<a name="l00324"></a>00324         <span class="keywordflow">elif</span> callback:
<a name="l00325"></a>00325             <span class="comment"># 1.0a support for callback in the request token request.</span>
<a name="l00326"></a>00326             parameters[<span class="stringliteral">&#39;oauth_callback&#39;</span>] = callback
<a name="l00327"></a>00327 
<a name="l00328"></a>00328         <span class="keywordflow">return</span> OAuthRequest(http_method, http_url, parameters)
<a name="l00329"></a>00329     from_consumer_and_token = staticmethod(from_consumer_and_token)
<a name="l00330"></a>00330 
<a name="l00331"></a>00331     <span class="keyword">def </span>from_token_and_callback(token, callback=None, http_method=HTTP_METHOD,
<a name="l00332"></a>00332             http_url=<span class="keywordtype">None</span>, parameters=<span class="keywordtype">None</span>):
<a name="l00333"></a>00333         <span class="keywordflow">if</span> <span class="keywordflow">not</span> parameters:
<a name="l00334"></a>00334             parameters = {}
<a name="l00335"></a>00335 
<a name="l00336"></a>00336         parameters[<span class="stringliteral">&#39;oauth_token&#39;</span>] = token.key
<a name="l00337"></a>00337 
<a name="l00338"></a>00338         <span class="keywordflow">if</span> callback:
<a name="l00339"></a>00339             parameters[<span class="stringliteral">&#39;oauth_callback&#39;</span>] = callback
<a name="l00340"></a>00340 
<a name="l00341"></a>00341         <span class="keywordflow">return</span> OAuthRequest(http_method, http_url, parameters)
<a name="l00342"></a>00342     from_token_and_callback = staticmethod(from_token_and_callback)
<a name="l00343"></a>00343 
<a name="l00344"></a>00344     <span class="keyword">def </span>_split_header(header):
<a name="l00345"></a>00345         <span class="stringliteral">&quot;&quot;&quot;Turn Authorization: header into parameters.&quot;&quot;&quot;</span>
<a name="l00346"></a>00346         params = {}
<a name="l00347"></a>00347         parts = header.split(<span class="stringliteral">&#39;,&#39;</span>)
<a name="l00348"></a>00348         <span class="keywordflow">for</span> param <span class="keywordflow">in</span> parts:
<a name="l00349"></a>00349             <span class="comment"># Ignore realm parameter.</span>
<a name="l00350"></a>00350             <span class="keywordflow">if</span> param.find(<span class="stringliteral">&#39;realm&#39;</span>) &gt; -1:
<a name="l00351"></a>00351                 <span class="keywordflow">continue</span>
<a name="l00352"></a>00352             <span class="comment"># Remove whitespace.</span>
<a name="l00353"></a>00353             param = param.strip()
<a name="l00354"></a>00354             <span class="comment"># Split key-value.</span>
<a name="l00355"></a>00355             param_parts = param.split(<span class="stringliteral">&#39;=&#39;</span>, 1)
<a name="l00356"></a>00356             <span class="comment"># Remove quotes and unescape the value.</span>
<a name="l00357"></a>00357             params[param_parts[0]] = urllib.unquote(param_parts[1].strip(<span class="stringliteral">&#39;\&quot;&#39;</span>))
<a name="l00358"></a>00358         <span class="keywordflow">return</span> params
<a name="l00359"></a>00359     _split_header = staticmethod(_split_header)
<a name="l00360"></a>00360 
<a name="l00361"></a>00361     <span class="keyword">def </span>_split_url_string(param_str):
<a name="l00362"></a>00362         <span class="stringliteral">&quot;&quot;&quot;Turn URL string into parameters.&quot;&quot;&quot;</span>
<a name="l00363"></a>00363         parameters = cgi.parse_qs(param_str, keep_blank_values=<span class="keyword">False</span>)
<a name="l00364"></a>00364         <span class="keywordflow">for</span> k, v <span class="keywordflow">in</span> parameters.iteritems():
<a name="l00365"></a>00365             parameters[k] = urllib.unquote(v[0])
<a name="l00366"></a>00366         <span class="keywordflow">return</span> parameters
<a name="l00367"></a>00367     _split_url_string = staticmethod(_split_url_string)
<a name="l00368"></a>00368 
<a name="l00369"></a><a class="code" href="classtweepy_1_1oauth_1_1OAuthServer.html">00369</a> <span class="keyword">class </span><a class="code" href="classtweepy_1_1oauth_1_1OAuthServer.html">OAuthServer</a>(object):
<a name="l00370"></a>00370     <span class="stringliteral">&quot;&quot;&quot;A worker to check the validity of a request against a data store.&quot;&quot;&quot;</span>
<a name="l00371"></a>00371     timestamp_threshold = 300 <span class="comment"># In seconds, five minutes.</span>
<a name="l00372"></a>00372     version = VERSION
<a name="l00373"></a>00373     signature_methods = <span class="keywordtype">None</span>
<a name="l00374"></a>00374     data_store = <span class="keywordtype">None</span>
<a name="l00375"></a>00375 
<a name="l00376"></a>00376     <span class="keyword">def </span>__init__(self, data_store=None, signature_methods=None):
<a name="l00377"></a>00377         self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthServer.html#a9bb9d00a308464013b284ef6feddc9ab">data_store</a> = data_store
<a name="l00378"></a>00378         self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthServer.html#a7a2c68c88f6e1b33d52c8a1fc727e521">signature_methods</a> = signature_methods <span class="keywordflow">or</span> {}
<a name="l00379"></a>00379 
<a name="l00380"></a>00380     <span class="keyword">def </span>set_data_store(self, data_store):
<a name="l00381"></a>00381         self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthServer.html#a9bb9d00a308464013b284ef6feddc9ab">data_store</a> = data_store
<a name="l00382"></a>00382 
<a name="l00383"></a>00383     <span class="keyword">def </span>get_data_store(self):
<a name="l00384"></a>00384         <span class="keywordflow">return</span> self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthServer.html#a9bb9d00a308464013b284ef6feddc9ab">data_store</a>
<a name="l00385"></a>00385 
<a name="l00386"></a>00386     <span class="keyword">def </span>add_signature_method(self, signature_method):
<a name="l00387"></a>00387         self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthServer.html#a7a2c68c88f6e1b33d52c8a1fc727e521">signature_methods</a>[signature_method.get_name()] = signature_method
<a name="l00388"></a>00388         <span class="keywordflow">return</span> self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthServer.html#a7a2c68c88f6e1b33d52c8a1fc727e521">signature_methods</a>
<a name="l00389"></a>00389 
<a name="l00390"></a><a class="code" href="classtweepy_1_1oauth_1_1OAuthServer.html#a10c9d0364ef2ecd19abf9e7d6c8f84b4">00390</a>     <span class="keyword">def </span><a class="code" href="classtweepy_1_1oauth_1_1OAuthServer.html#a10c9d0364ef2ecd19abf9e7d6c8f84b4">fetch_request_token</a>(self, oauth_request):
<a name="l00391"></a>00391         <span class="stringliteral">&quot;&quot;&quot;Processes a request_token request and returns the</span>
<a name="l00392"></a>00392 <span class="stringliteral">        request token on success.</span>
<a name="l00393"></a>00393 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l00394"></a>00394         <span class="keywordflow">try</span>:
<a name="l00395"></a>00395             <span class="comment"># Get the request token for authorization.</span>
<a name="l00396"></a>00396             token = self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthServer.html#af2ff2e1efac79bc83d5233e0db633178">_get_token</a>(oauth_request, <span class="stringliteral">&#39;request&#39;</span>)
<a name="l00397"></a>00397         <span class="keywordflow">except</span> OAuthError:
<a name="l00398"></a>00398             <span class="comment"># No token required for the initial token request.</span>
<a name="l00399"></a>00399             version = self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthServer.html#a15ec06954588ba5234f503f4e6076b1c">_get_version</a>(oauth_request)
<a name="l00400"></a>00400             consumer = self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthServer.html#a7012e8b9294099e50b446af2c89a04df">_get_consumer</a>(oauth_request)
<a name="l00401"></a>00401             <span class="keywordflow">try</span>:
<a name="l00402"></a>00402                 callback = self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthServer.html#a8c8d6001089d24681f7c493bc87cb6b7">get_callback</a>(oauth_request)
<a name="l00403"></a>00403             <span class="keywordflow">except</span> OAuthError:
<a name="l00404"></a>00404                 callback = <span class="keywordtype">None</span> <span class="comment"># 1.0, no callback specified.</span>
<a name="l00405"></a>00405             self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthServer.html#a4aed6ad7dbbcae4814d40e00914a53b3">_check_signature</a>(oauth_request, consumer, <span class="keywordtype">None</span>)
<a name="l00406"></a>00406             <span class="comment"># Fetch a new token.</span>
<a name="l00407"></a>00407             token = self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthServer.html#a9bb9d00a308464013b284ef6feddc9ab">data_store</a>.fetch_request_token(consumer, callback)
<a name="l00408"></a>00408         <span class="keywordflow">return</span> token
<a name="l00409"></a>00409 
<a name="l00410"></a><a class="code" href="classtweepy_1_1oauth_1_1OAuthServer.html#a217ab872c6135baa1599f51cd3c89edd">00410</a>     <span class="keyword">def </span><a class="code" href="classtweepy_1_1oauth_1_1OAuthServer.html#a217ab872c6135baa1599f51cd3c89edd">fetch_access_token</a>(self, oauth_request):
<a name="l00411"></a>00411         <span class="stringliteral">&quot;&quot;&quot;Processes an access_token request and returns the</span>
<a name="l00412"></a>00412 <span class="stringliteral">        access token on success.</span>
<a name="l00413"></a>00413 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l00414"></a>00414         version = self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthServer.html#a15ec06954588ba5234f503f4e6076b1c">_get_version</a>(oauth_request)
<a name="l00415"></a>00415         consumer = self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthServer.html#a7012e8b9294099e50b446af2c89a04df">_get_consumer</a>(oauth_request)
<a name="l00416"></a>00416         <span class="keywordflow">try</span>:
<a name="l00417"></a>00417             verifier = self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthServer.html#a5f92188a993e3280b250525ce01f2856">_get_verifier</a>(oauth_request)
<a name="l00418"></a>00418         <span class="keywordflow">except</span> OAuthError:
<a name="l00419"></a>00419             verifier = <span class="keywordtype">None</span>
<a name="l00420"></a>00420         <span class="comment"># Get the request token.</span>
<a name="l00421"></a>00421         token = self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthServer.html#af2ff2e1efac79bc83d5233e0db633178">_get_token</a>(oauth_request, <span class="stringliteral">&#39;request&#39;</span>)
<a name="l00422"></a>00422         self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthServer.html#a4aed6ad7dbbcae4814d40e00914a53b3">_check_signature</a>(oauth_request, consumer, token)
<a name="l00423"></a>00423         new_token = self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthServer.html#a9bb9d00a308464013b284ef6feddc9ab">data_store</a>.fetch_access_token(consumer, token, verifier)
<a name="l00424"></a>00424         <span class="keywordflow">return</span> new_token
<a name="l00425"></a>00425 
<a name="l00426"></a><a class="code" href="classtweepy_1_1oauth_1_1OAuthServer.html#ac3c64289254ff901cc1afd2780f04284">00426</a>     <span class="keyword">def </span><a class="code" href="classtweepy_1_1oauth_1_1OAuthServer.html#ac3c64289254ff901cc1afd2780f04284">verify_request</a>(self, oauth_request):
<a name="l00427"></a>00427         <span class="stringliteral">&quot;&quot;&quot;Verifies an api call and checks all the parameters.&quot;&quot;&quot;</span>
<a name="l00428"></a>00428         <span class="comment"># -&gt; consumer and token</span>
<a name="l00429"></a>00429         version = self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthServer.html#a15ec06954588ba5234f503f4e6076b1c">_get_version</a>(oauth_request)
<a name="l00430"></a>00430         consumer = self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthServer.html#a7012e8b9294099e50b446af2c89a04df">_get_consumer</a>(oauth_request)
<a name="l00431"></a>00431         <span class="comment"># Get the access token.</span>
<a name="l00432"></a>00432         token = self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthServer.html#af2ff2e1efac79bc83d5233e0db633178">_get_token</a>(oauth_request, <span class="stringliteral">&#39;access&#39;</span>)
<a name="l00433"></a>00433         self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthServer.html#a4aed6ad7dbbcae4814d40e00914a53b3">_check_signature</a>(oauth_request, consumer, token)
<a name="l00434"></a>00434         parameters = oauth_request.get_nonoauth_parameters()
<a name="l00435"></a>00435         <span class="keywordflow">return</span> consumer, token, parameters
<a name="l00436"></a>00436 
<a name="l00437"></a><a class="code" href="classtweepy_1_1oauth_1_1OAuthServer.html#a342687c5acb3b0afd17525b2f12e07fc">00437</a>     <span class="keyword">def </span><a class="code" href="classtweepy_1_1oauth_1_1OAuthServer.html#a342687c5acb3b0afd17525b2f12e07fc">authorize_token</a>(self, token, user):
<a name="l00438"></a>00438         <span class="stringliteral">&quot;&quot;&quot;Authorize a request token.&quot;&quot;&quot;</span>
<a name="l00439"></a>00439         <span class="keywordflow">return</span> self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthServer.html#a9bb9d00a308464013b284ef6feddc9ab">data_store</a>.authorize_request_token(token, user)
<a name="l00440"></a>00440 
<a name="l00441"></a><a class="code" href="classtweepy_1_1oauth_1_1OAuthServer.html#a8c8d6001089d24681f7c493bc87cb6b7">00441</a>     <span class="keyword">def </span><a class="code" href="classtweepy_1_1oauth_1_1OAuthServer.html#a8c8d6001089d24681f7c493bc87cb6b7">get_callback</a>(self, oauth_request):
<a name="l00442"></a>00442         <span class="stringliteral">&quot;&quot;&quot;Get the callback URL.&quot;&quot;&quot;</span>
<a name="l00443"></a>00443         <span class="keywordflow">return</span> oauth_request.get_parameter(<span class="stringliteral">&#39;oauth_callback&#39;</span>)
<a name="l00444"></a>00444  
<a name="l00445"></a><a class="code" href="classtweepy_1_1oauth_1_1OAuthServer.html#ad50294ea4dcc953173295d8a50c06cfc">00445</a>     <span class="keyword">def </span><a class="code" href="classtweepy_1_1oauth_1_1OAuthServer.html#ad50294ea4dcc953173295d8a50c06cfc">build_authenticate_header</a>(self, realm=&#39;&#39;):
<a name="l00446"></a>00446         <span class="stringliteral">&quot;&quot;&quot;Optional support for the authenticate header.&quot;&quot;&quot;</span>
<a name="l00447"></a>00447         <span class="keywordflow">return</span> {<span class="stringliteral">&#39;WWW-Authenticate&#39;</span>: <span class="stringliteral">&#39;OAuth realm=&quot;%s&quot;&#39;</span> % realm}
<a name="l00448"></a>00448 
<a name="l00449"></a>00449     <span class="keyword">def </span>_get_version(self, oauth_request):
<a name="l00450"></a>00450         <span class="stringliteral">&quot;&quot;&quot;Verify the correct version request for this server.&quot;&quot;&quot;</span>
<a name="l00451"></a>00451         <span class="keywordflow">try</span>:
<a name="l00452"></a>00452             version = oauth_request.get_parameter(<span class="stringliteral">&#39;oauth_version&#39;</span>)
<a name="l00453"></a>00453         <span class="keywordflow">except</span>:
<a name="l00454"></a>00454             version = VERSION
<a name="l00455"></a>00455         <span class="keywordflow">if</span> version <span class="keywordflow">and</span> version != self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthServer.html#a2d5a3fd854be2a29502940475e872b2b">version</a>:
<a name="l00456"></a>00456             <span class="keywordflow">raise</span> OAuthError(<span class="stringliteral">&#39;OAuth version %s not supported.&#39;</span> % str(version))
<a name="l00457"></a>00457         <span class="keywordflow">return</span> version
<a name="l00458"></a>00458 
<a name="l00459"></a>00459     <span class="keyword">def </span>_get_signature_method(self, oauth_request):
<a name="l00460"></a>00460         <span class="stringliteral">&quot;&quot;&quot;Figure out the signature with some defaults.&quot;&quot;&quot;</span>
<a name="l00461"></a>00461         <span class="keywordflow">try</span>:
<a name="l00462"></a>00462             signature_method = oauth_request.get_parameter(
<a name="l00463"></a>00463                 <span class="stringliteral">&#39;oauth_signature_method&#39;</span>)
<a name="l00464"></a>00464         <span class="keywordflow">except</span>:
<a name="l00465"></a>00465             signature_method = SIGNATURE_METHOD
<a name="l00466"></a>00466         <span class="keywordflow">try</span>:
<a name="l00467"></a>00467             <span class="comment"># Get the signature method object.</span>
<a name="l00468"></a>00468             signature_method = self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthServer.html#a7a2c68c88f6e1b33d52c8a1fc727e521">signature_methods</a>[signature_method]
<a name="l00469"></a>00469         <span class="keywordflow">except</span>:
<a name="l00470"></a>00470             signature_method_names = <span class="stringliteral">&#39;, &#39;</span>.join(self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthServer.html#a7a2c68c88f6e1b33d52c8a1fc727e521">signature_methods</a>.keys())
<a name="l00471"></a>00471             <span class="keywordflow">raise</span> OAuthError(<span class="stringliteral">&#39;Signature method %s not supported try one of the &#39;</span>
<a name="l00472"></a>00472                 <span class="stringliteral">&#39;following: %s&#39;</span> % (signature_method, signature_method_names))
<a name="l00473"></a>00473 
<a name="l00474"></a>00474         <span class="keywordflow">return</span> signature_method
<a name="l00475"></a>00475 
<a name="l00476"></a>00476     <span class="keyword">def </span>_get_consumer(self, oauth_request):
<a name="l00477"></a>00477         consumer_key = oauth_request.get_parameter(<span class="stringliteral">&#39;oauth_consumer_key&#39;</span>)
<a name="l00478"></a>00478         consumer = self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthServer.html#a9bb9d00a308464013b284ef6feddc9ab">data_store</a>.lookup_consumer(consumer_key)
<a name="l00479"></a>00479         <span class="keywordflow">if</span> <span class="keywordflow">not</span> consumer:
<a name="l00480"></a>00480             <span class="keywordflow">raise</span> OAuthError(<span class="stringliteral">&#39;Invalid consumer.&#39;</span>)
<a name="l00481"></a>00481         <span class="keywordflow">return</span> consumer
<a name="l00482"></a>00482 
<a name="l00483"></a>00483     <span class="keyword">def </span>_get_token(self, oauth_request, token_type=&#39;access&#39;):
<a name="l00484"></a>00484         <span class="stringliteral">&quot;&quot;&quot;Try to find the token for the provided request token key.&quot;&quot;&quot;</span>
<a name="l00485"></a>00485         token_field = oauth_request.get_parameter(<span class="stringliteral">&#39;oauth_token&#39;</span>)
<a name="l00486"></a>00486         token = self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthServer.html#a9bb9d00a308464013b284ef6feddc9ab">data_store</a>.lookup_token(token_type, token_field)
<a name="l00487"></a>00487         <span class="keywordflow">if</span> <span class="keywordflow">not</span> token:
<a name="l00488"></a>00488             <span class="keywordflow">raise</span> OAuthError(<span class="stringliteral">&#39;Invalid %s token: %s&#39;</span> % (token_type, token_field))
<a name="l00489"></a>00489         <span class="keywordflow">return</span> token
<a name="l00490"></a>00490     
<a name="l00491"></a>00491     <span class="keyword">def </span>_get_verifier(self, oauth_request):
<a name="l00492"></a>00492         <span class="keywordflow">return</span> oauth_request.get_parameter(<span class="stringliteral">&#39;oauth_verifier&#39;</span>)
<a name="l00493"></a>00493 
<a name="l00494"></a>00494     <span class="keyword">def </span>_check_signature(self, oauth_request, consumer, token):
<a name="l00495"></a>00495         timestamp, nonce = oauth_request._get_timestamp_nonce()
<a name="l00496"></a>00496         self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthServer.html#a653d3266a4e4188ad9a6a8341a2167ba">_check_timestamp</a>(timestamp)
<a name="l00497"></a>00497         self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthServer.html#a0aed03fea85b9f82d550f0c6975e9d67">_check_nonce</a>(consumer, token, nonce)
<a name="l00498"></a>00498         signature_method = self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthServer.html#a901048fd3a90fcc50e5f620c0219d177">_get_signature_method</a>(oauth_request)
<a name="l00499"></a>00499         <span class="keywordflow">try</span>:
<a name="l00500"></a>00500             signature = oauth_request.get_parameter(<span class="stringliteral">&#39;oauth_signature&#39;</span>)
<a name="l00501"></a>00501         <span class="keywordflow">except</span>:
<a name="l00502"></a>00502             <span class="keywordflow">raise</span> OAuthError(<span class="stringliteral">&#39;Missing signature.&#39;</span>)
<a name="l00503"></a>00503         <span class="comment"># Validate the signature.</span>
<a name="l00504"></a>00504         valid_sig = signature_method.check_signature(oauth_request, consumer,
<a name="l00505"></a>00505             token, signature)
<a name="l00506"></a>00506         <span class="keywordflow">if</span> <span class="keywordflow">not</span> valid_sig:
<a name="l00507"></a>00507             key, base = signature_method.build_signature_base_string(
<a name="l00508"></a>00508                 oauth_request, consumer, token)
<a name="l00509"></a>00509             <span class="keywordflow">raise</span> OAuthError(<span class="stringliteral">&#39;Invalid signature. Expected signature base &#39;</span>
<a name="l00510"></a>00510                 <span class="stringliteral">&#39;string: %s&#39;</span> % base)
<a name="l00511"></a>00511         built = signature_method.build_signature(oauth_request, consumer, token)
<a name="l00512"></a>00512 
<a name="l00513"></a>00513     <span class="keyword">def </span>_check_timestamp(self, timestamp):
<a name="l00514"></a>00514         <span class="stringliteral">&quot;&quot;&quot;Verify that timestamp is recentish.&quot;&quot;&quot;</span>
<a name="l00515"></a>00515         timestamp = int(timestamp)
<a name="l00516"></a>00516         now = int(time.time())
<a name="l00517"></a>00517         lapsed = abs(now - timestamp)
<a name="l00518"></a>00518         <span class="keywordflow">if</span> lapsed &gt; self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthServer.html#a113a60cc660256041732972bf8c44071">timestamp_threshold</a>:
<a name="l00519"></a>00519             <span class="keywordflow">raise</span> OAuthError(<span class="stringliteral">&#39;Expired timestamp: given %d and now %s has a &#39;</span>
<a name="l00520"></a>00520                 <span class="stringliteral">&#39;greater difference than threshold %d&#39;</span> %
<a name="l00521"></a>00521                 (timestamp, now, self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthServer.html#a113a60cc660256041732972bf8c44071">timestamp_threshold</a>))
<a name="l00522"></a>00522 
<a name="l00523"></a>00523     <span class="keyword">def </span>_check_nonce(self, consumer, token, nonce):
<a name="l00524"></a>00524         <span class="stringliteral">&quot;&quot;&quot;Verify that the nonce is uniqueish.&quot;&quot;&quot;</span>
<a name="l00525"></a>00525         nonce = self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthServer.html#a9bb9d00a308464013b284ef6feddc9ab">data_store</a>.lookup_nonce(consumer, token, nonce)
<a name="l00526"></a>00526         <span class="keywordflow">if</span> nonce:
<a name="l00527"></a>00527             <span class="keywordflow">raise</span> OAuthError(<span class="stringliteral">&#39;Nonce already used: %s&#39;</span> % str(nonce))
<a name="l00528"></a>00528 
<a name="l00529"></a>00529 
<a name="l00530"></a><a class="code" href="classtweepy_1_1oauth_1_1OAuthClient.html">00530</a> <span class="keyword">class </span><a class="code" href="classtweepy_1_1oauth_1_1OAuthClient.html">OAuthClient</a>(object):
<a name="l00531"></a>00531     <span class="stringliteral">&quot;&quot;&quot;OAuthClient is a worker to attempt to execute a request.&quot;&quot;&quot;</span>
<a name="l00532"></a>00532     consumer = <span class="keywordtype">None</span>
<a name="l00533"></a>00533     token = <span class="keywordtype">None</span>
<a name="l00534"></a>00534 
<a name="l00535"></a>00535     <span class="keyword">def </span>__init__(self, oauth_consumer, oauth_token):
<a name="l00536"></a>00536         self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthClient.html#a4ae476de6d06f303ce0375fcc6e7a74b">consumer</a> = oauth_consumer
<a name="l00537"></a>00537         self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthClient.html#a790949a2eb70ccb5dea35242ac5be950">token</a> = oauth_token
<a name="l00538"></a>00538 
<a name="l00539"></a>00539     <span class="keyword">def </span>get_consumer(self):
<a name="l00540"></a>00540         <span class="keywordflow">return</span> self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthClient.html#a4ae476de6d06f303ce0375fcc6e7a74b">consumer</a>
<a name="l00541"></a>00541 
<a name="l00542"></a>00542     <span class="keyword">def </span>get_token(self):
<a name="l00543"></a>00543         <span class="keywordflow">return</span> self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthClient.html#a790949a2eb70ccb5dea35242ac5be950">token</a>
<a name="l00544"></a>00544 
<a name="l00545"></a><a class="code" href="classtweepy_1_1oauth_1_1OAuthClient.html#a8210c9adeaa273ba2923f88dcd6f3f28">00545</a>     <span class="keyword">def </span><a class="code" href="classtweepy_1_1oauth_1_1OAuthClient.html#a8210c9adeaa273ba2923f88dcd6f3f28">fetch_request_token</a>(self, oauth_request):
<a name="l00546"></a>00546         <span class="stringliteral">&quot;&quot;&quot;-&gt; OAuthToken.&quot;&quot;&quot;</span>
<a name="l00547"></a>00547         <span class="keywordflow">raise</span> NotImplementedError
<a name="l00548"></a>00548 
<a name="l00549"></a><a class="code" href="classtweepy_1_1oauth_1_1OAuthClient.html#ab955bfe2622aa33a604f962936b23b23">00549</a>     <span class="keyword">def </span><a class="code" href="classtweepy_1_1oauth_1_1OAuthClient.html#ab955bfe2622aa33a604f962936b23b23">fetch_access_token</a>(self, oauth_request):
<a name="l00550"></a>00550         <span class="stringliteral">&quot;&quot;&quot;-&gt; OAuthToken.&quot;&quot;&quot;</span>
<a name="l00551"></a>00551         <span class="keywordflow">raise</span> NotImplementedError
<a name="l00552"></a>00552 
<a name="l00553"></a><a class="code" href="classtweepy_1_1oauth_1_1OAuthClient.html#a78b9e950caf60df4e0c9c5698aaba181">00553</a>     <span class="keyword">def </span><a class="code" href="classtweepy_1_1oauth_1_1OAuthClient.html#a78b9e950caf60df4e0c9c5698aaba181">access_resource</a>(self, oauth_request):
<a name="l00554"></a>00554         <span class="stringliteral">&quot;&quot;&quot;-&gt; Some protected resource.&quot;&quot;&quot;</span>
<a name="l00555"></a>00555         <span class="keywordflow">raise</span> NotImplementedError
<a name="l00556"></a>00556 
<a name="l00557"></a>00557 
<a name="l00558"></a><a class="code" href="classtweepy_1_1oauth_1_1OAuthDataStore.html">00558</a> <span class="keyword">class </span><a class="code" href="classtweepy_1_1oauth_1_1OAuthDataStore.html">OAuthDataStore</a>(object):
<a name="l00559"></a>00559     <span class="stringliteral">&quot;&quot;&quot;A database abstraction used to lookup consumers and tokens.&quot;&quot;&quot;</span>
<a name="l00560"></a>00560 
<a name="l00561"></a><a class="code" href="classtweepy_1_1oauth_1_1OAuthDataStore.html#ad4f483713a89f585e301bf44b1d55da8">00561</a>     <span class="keyword">def </span><a class="code" href="classtweepy_1_1oauth_1_1OAuthDataStore.html#ad4f483713a89f585e301bf44b1d55da8">lookup_consumer</a>(self, key):
<a name="l00562"></a>00562         <span class="stringliteral">&quot;&quot;&quot;-&gt; OAuthConsumer.&quot;&quot;&quot;</span>
<a name="l00563"></a>00563         <span class="keywordflow">raise</span> NotImplementedError
<a name="l00564"></a>00564 
<a name="l00565"></a><a class="code" href="classtweepy_1_1oauth_1_1OAuthDataStore.html#a4fcb8f42d0242b7f8676ebaee7696f17">00565</a>     <span class="keyword">def </span><a class="code" href="classtweepy_1_1oauth_1_1OAuthDataStore.html#a4fcb8f42d0242b7f8676ebaee7696f17">lookup_token</a>(self, oauth_consumer, token_type, token_token):
<a name="l00566"></a>00566         <span class="stringliteral">&quot;&quot;&quot;-&gt; OAuthToken.&quot;&quot;&quot;</span>
<a name="l00567"></a>00567         <span class="keywordflow">raise</span> NotImplementedError
<a name="l00568"></a>00568 
<a name="l00569"></a><a class="code" href="classtweepy_1_1oauth_1_1OAuthDataStore.html#a7bb8cc1f39490516e2a42b0c192c9455">00569</a>     <span class="keyword">def </span><a class="code" href="classtweepy_1_1oauth_1_1OAuthDataStore.html#a7bb8cc1f39490516e2a42b0c192c9455">lookup_nonce</a>(self, oauth_consumer, oauth_token, nonce):
<a name="l00570"></a>00570         <span class="stringliteral">&quot;&quot;&quot;-&gt; OAuthToken.&quot;&quot;&quot;</span>
<a name="l00571"></a>00571         <span class="keywordflow">raise</span> NotImplementedError
<a name="l00572"></a>00572 
<a name="l00573"></a><a class="code" href="classtweepy_1_1oauth_1_1OAuthDataStore.html#ad7d8e47cf0d9c84c4a7b5189d807821e">00573</a>     <span class="keyword">def </span><a class="code" href="classtweepy_1_1oauth_1_1OAuthDataStore.html#ad7d8e47cf0d9c84c4a7b5189d807821e">fetch_request_token</a>(self, oauth_consumer, oauth_callback):
<a name="l00574"></a>00574         <span class="stringliteral">&quot;&quot;&quot;-&gt; OAuthToken.&quot;&quot;&quot;</span>
<a name="l00575"></a>00575         <span class="keywordflow">raise</span> NotImplementedError
<a name="l00576"></a>00576 
<a name="l00577"></a><a class="code" href="classtweepy_1_1oauth_1_1OAuthDataStore.html#a0144627c4dbba0218a98e88363acf043">00577</a>     <span class="keyword">def </span><a class="code" href="classtweepy_1_1oauth_1_1OAuthDataStore.html#a0144627c4dbba0218a98e88363acf043">fetch_access_token</a>(self, oauth_consumer, oauth_token, oauth_verifier):
<a name="l00578"></a>00578         <span class="stringliteral">&quot;&quot;&quot;-&gt; OAuthToken.&quot;&quot;&quot;</span>
<a name="l00579"></a>00579         <span class="keywordflow">raise</span> NotImplementedError
<a name="l00580"></a>00580 
<a name="l00581"></a><a class="code" href="classtweepy_1_1oauth_1_1OAuthDataStore.html#ad149e5e6722d8769011cd9e07ee45c28">00581</a>     <span class="keyword">def </span><a class="code" href="classtweepy_1_1oauth_1_1OAuthDataStore.html#ad149e5e6722d8769011cd9e07ee45c28">authorize_request_token</a>(self, oauth_token, user):
<a name="l00582"></a>00582         <span class="stringliteral">&quot;&quot;&quot;-&gt; OAuthToken.&quot;&quot;&quot;</span>
<a name="l00583"></a>00583         <span class="keywordflow">raise</span> NotImplementedError
<a name="l00584"></a>00584 
<a name="l00585"></a>00585 
<a name="l00586"></a><a class="code" href="classtweepy_1_1oauth_1_1OAuthSignatureMethod.html">00586</a> <span class="keyword">class </span><a class="code" href="classtweepy_1_1oauth_1_1OAuthSignatureMethod.html">OAuthSignatureMethod</a>(object):
<a name="l00587"></a>00587     <span class="stringliteral">&quot;&quot;&quot;A strategy class that implements a signature method.&quot;&quot;&quot;</span>
<a name="l00588"></a><a class="code" href="classtweepy_1_1oauth_1_1OAuthSignatureMethod.html#abe4b56cdb6f96c051a1acdd386b60576">00588</a>     <span class="keyword">def </span><a class="code" href="classtweepy_1_1oauth_1_1OAuthSignatureMethod.html#abe4b56cdb6f96c051a1acdd386b60576">get_name</a>(self):
<a name="l00589"></a>00589         <span class="stringliteral">&quot;&quot;&quot;-&gt; str.&quot;&quot;&quot;</span>
<a name="l00590"></a>00590         <span class="keywordflow">raise</span> NotImplementedError
<a name="l00591"></a>00591 
<a name="l00592"></a><a class="code" href="classtweepy_1_1oauth_1_1OAuthSignatureMethod.html#a6d3130161725287e210138809e1f06e8">00592</a>     <span class="keyword">def </span><a class="code" href="classtweepy_1_1oauth_1_1OAuthSignatureMethod.html#a6d3130161725287e210138809e1f06e8">build_signature_base_string</a>(self, oauth_request, oauth_consumer, oauth_token):
<a name="l00593"></a>00593         <span class="stringliteral">&quot;&quot;&quot;-&gt; str key, str raw.&quot;&quot;&quot;</span>
<a name="l00594"></a>00594         <span class="keywordflow">raise</span> NotImplementedError
<a name="l00595"></a>00595 
<a name="l00596"></a><a class="code" href="classtweepy_1_1oauth_1_1OAuthSignatureMethod.html#ae40f44626ff8fc36c7d2f4cb69f6ddc1">00596</a>     <span class="keyword">def </span><a class="code" href="classtweepy_1_1oauth_1_1OAuthSignatureMethod.html#ae40f44626ff8fc36c7d2f4cb69f6ddc1">build_signature</a>(self, oauth_request, oauth_consumer, oauth_token):
<a name="l00597"></a>00597         <span class="stringliteral">&quot;&quot;&quot;-&gt; str.&quot;&quot;&quot;</span>
<a name="l00598"></a>00598         <span class="keywordflow">raise</span> NotImplementedError
<a name="l00599"></a>00599 
<a name="l00600"></a>00600     <span class="keyword">def </span>check_signature(self, oauth_request, consumer, token, signature):
<a name="l00601"></a>00601         built = self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthSignatureMethod.html#ae40f44626ff8fc36c7d2f4cb69f6ddc1">build_signature</a>(oauth_request, consumer, token)
<a name="l00602"></a>00602         <span class="keywordflow">return</span> built == signature
<a name="l00603"></a>00603 
<a name="l00604"></a>00604 
<a name="l00605"></a><a class="code" href="classtweepy_1_1oauth_1_1OAuthSignatureMethod__HMAC__SHA1.html">00605</a> <span class="keyword">class </span><a class="code" href="classtweepy_1_1oauth_1_1OAuthSignatureMethod__HMAC__SHA1.html">OAuthSignatureMethod_HMAC_SHA1</a>(<a class="code" href="classtweepy_1_1oauth_1_1OAuthSignatureMethod.html">OAuthSignatureMethod</a>):
<a name="l00606"></a>00606 
<a name="l00607"></a><a class="code" href="classtweepy_1_1oauth_1_1OAuthSignatureMethod__HMAC__SHA1.html#ab5b9b6531826afc2e41bb6edab70bcd3">00607</a>     <span class="keyword">def </span><a class="code" href="classtweepy_1_1oauth_1_1OAuthSignatureMethod__HMAC__SHA1.html#ab5b9b6531826afc2e41bb6edab70bcd3">get_name</a>(self):
<a name="l00608"></a>00608         <span class="keywordflow">return</span> <span class="stringliteral">&#39;HMAC-SHA1&#39;</span>
<a name="l00609"></a>00609         
<a name="l00610"></a><a class="code" href="classtweepy_1_1oauth_1_1OAuthSignatureMethod__HMAC__SHA1.html#aee0d146bb37855616fe06d92ff603181">00610</a>     <span class="keyword">def </span><a class="code" href="classtweepy_1_1oauth_1_1OAuthSignatureMethod__HMAC__SHA1.html#aee0d146bb37855616fe06d92ff603181">build_signature_base_string</a>(self, oauth_request, consumer, token):
<a name="l00611"></a>00611         sig = (
<a name="l00612"></a>00612             escape(oauth_request.get_normalized_http_method()),
<a name="l00613"></a>00613             escape(oauth_request.get_normalized_http_url()),
<a name="l00614"></a>00614             escape(oauth_request.get_normalized_parameters()),
<a name="l00615"></a>00615         )
<a name="l00616"></a>00616 
<a name="l00617"></a>00617         key = <span class="stringliteral">&#39;%s&amp;&#39;</span> % escape(consumer.secret)
<a name="l00618"></a>00618         <span class="keywordflow">if</span> token:
<a name="l00619"></a>00619             key += escape(token.secret)
<a name="l00620"></a>00620         raw = <span class="stringliteral">&#39;&amp;&#39;</span>.join(sig)
<a name="l00621"></a>00621         <span class="keywordflow">return</span> key, raw
<a name="l00622"></a>00622 
<a name="l00623"></a><a class="code" href="classtweepy_1_1oauth_1_1OAuthSignatureMethod__HMAC__SHA1.html#ab866586a5126d6d947b88f91728cda31">00623</a>     <span class="keyword">def </span><a class="code" href="classtweepy_1_1oauth_1_1OAuthSignatureMethod__HMAC__SHA1.html#ab866586a5126d6d947b88f91728cda31">build_signature</a>(self, oauth_request, consumer, token):
<a name="l00624"></a>00624         <span class="stringliteral">&quot;&quot;&quot;Builds the base signature string.&quot;&quot;&quot;</span>
<a name="l00625"></a>00625         key, raw = self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthSignatureMethod__HMAC__SHA1.html#aee0d146bb37855616fe06d92ff603181">build_signature_base_string</a>(oauth_request, consumer,
<a name="l00626"></a>00626             token)
<a name="l00627"></a>00627 
<a name="l00628"></a>00628         <span class="comment"># HMAC object.</span>
<a name="l00629"></a>00629         <span class="keywordflow">try</span>:
<a name="l00630"></a>00630             <span class="keyword">import</span> hashlib <span class="comment"># 2.5</span>
<a name="l00631"></a>00631             hashed = hmac.new(key, raw, hashlib.sha1)
<a name="l00632"></a>00632         <span class="keywordflow">except</span>:
<a name="l00633"></a>00633             <span class="keyword">import</span> sha <span class="comment"># Deprecated</span>
<a name="l00634"></a>00634             hashed = hmac.new(key, raw, sha)
<a name="l00635"></a>00635 
<a name="l00636"></a>00636         <span class="comment"># Calculate the digest base 64.</span>
<a name="l00637"></a>00637         <span class="keywordflow">return</span> binascii.b2a_base64(hashed.digest())[:-1]
<a name="l00638"></a>00638 
<a name="l00639"></a>00639 
<a name="l00640"></a><a class="code" href="classtweepy_1_1oauth_1_1OAuthSignatureMethod__PLAINTEXT.html">00640</a> <span class="keyword">class </span><a class="code" href="classtweepy_1_1oauth_1_1OAuthSignatureMethod__PLAINTEXT.html">OAuthSignatureMethod_PLAINTEXT</a>(<a class="code" href="classtweepy_1_1oauth_1_1OAuthSignatureMethod.html">OAuthSignatureMethod</a>):
<a name="l00641"></a>00641 
<a name="l00642"></a><a class="code" href="classtweepy_1_1oauth_1_1OAuthSignatureMethod__PLAINTEXT.html#a039521651ca37e2c3b60e582c96db028">00642</a>     <span class="keyword">def </span><a class="code" href="classtweepy_1_1oauth_1_1OAuthSignatureMethod__PLAINTEXT.html#a039521651ca37e2c3b60e582c96db028">get_name</a>(self):
<a name="l00643"></a>00643         <span class="keywordflow">return</span> <span class="stringliteral">&#39;PLAINTEXT&#39;</span>
<a name="l00644"></a>00644 
<a name="l00645"></a><a class="code" href="classtweepy_1_1oauth_1_1OAuthSignatureMethod__PLAINTEXT.html#afb276747825dc787a06d3f094be78dca">00645</a>     <span class="keyword">def </span><a class="code" href="classtweepy_1_1oauth_1_1OAuthSignatureMethod__PLAINTEXT.html#afb276747825dc787a06d3f094be78dca">build_signature_base_string</a>(self, oauth_request, consumer, token):
<a name="l00646"></a>00646         <span class="stringliteral">&quot;&quot;&quot;Concatenates the consumer key and secret.&quot;&quot;&quot;</span>
<a name="l00647"></a>00647         sig = <span class="stringliteral">&#39;%s&amp;&#39;</span> % escape(consumer.secret)
<a name="l00648"></a>00648         <span class="keywordflow">if</span> token:
<a name="l00649"></a>00649             sig = sig + escape(token.secret)
<a name="l00650"></a>00650         <span class="keywordflow">return</span> sig, sig
<a name="l00651"></a>00651 
<a name="l00652"></a><a class="code" href="classtweepy_1_1oauth_1_1OAuthSignatureMethod__PLAINTEXT.html#a1464a1c08f0d774ac4d8f91868ec04eb">00652</a>     <span class="keyword">def </span><a class="code" href="classtweepy_1_1oauth_1_1OAuthSignatureMethod__PLAINTEXT.html#a1464a1c08f0d774ac4d8f91868ec04eb">build_signature</a>(self, oauth_request, consumer, token):
<a name="l00653"></a>00653         key, raw = self.<a class="code" href="classtweepy_1_1oauth_1_1OAuthSignatureMethod__PLAINTEXT.html#afb276747825dc787a06d3f094be78dca">build_signature_base_string</a>(oauth_request, consumer,
<a name="l00654"></a>00654             token)
<a name="l00655"></a>00655         <span class="keywordflow">return</span> key
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Sun Jun 24 2012 20:50:11 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
